# Тестовое задание для infotecs 21.02.2021

### ТЗ:

>Реализовать HTTP-сервер для предоставления информации по географическим объектам.
>Данные взять из географической базы данных GeoNames.

### Реализованный сервер должен предоставлять REST API со следующими методами:

 - Метод принимает идентификатор geonameid и возвращает информацию о городе.
 - Метод принимает страницу и количество отображаемых на странице городов и возвращает список городов с их информацией. 
 - Метод принимает названия двух городов (на русском языке) и получает информацию о найденных городах, а также дополнительно: какой из них расположен севернее и одинаковая ли у них временная зона (когда несколько городов имеют одно и то же название, разрешать неоднозначность выбирая город с большим населением; если население совпадает, брать первый попавшийся) .
 - Дополнительное задание: для 3-его метода показывать пользователю не только факт различия временных зон, но и на сколько они различаются.



### Реализация
Версия Python 3.9

В проекте применен современный асинхронный фреймворк FastAPI.

Инструкцию по запуску скрипта можно найти в [документации фреймворка](https://fastapi.tiangolo.com/#installation).

Доступ к сервису можно получить по адресу 127.0.0.1:8000

Файл импортируется в кодировке 'utf-8', после чего обрабатывается и загружается в список, который хранится в оперативной памяти.

### Задание 1:

Метод доступен по адресу 

```http request
127.0.0.1:8000/city_info?geoname_id=int
```

Данный метод принимает 1 параметр GET: 'geonameid', который должен содержать id города в базе данных geoname

Поиск искомого города происходит через бинарный поиск. Примерное время затраченное на поиск города:

Результат запроса:
```json
{
  "geonameid": id,
  "name": name,
  "asciiname": asciiname,
  "alternatenames": alternatenames,
  "latitude": latitude,
  "longtitude": longtitude,
  "feature_class": feature_class,
  "feature_code": feature_code,
  "county_code": country_code,
  "cc2": cc2,
  "admin1_code": admin1_code,
  "admin2_code": admin2_code,
  "admin3_code": admin3_code,
  "admin4_code": admin4_code,
  "population": population,
  "elevation": elevation,
  "dem": dem,
  "timezone": timezone,
  "modification_date": modification_date
}
```



### Задание 2:

Метод доступен по адресу 

```web-idl
127.0.0.1:8000/cities_page?page=int&page_size=int
```

Данный метод принимает 2 параметра GET: 'page', который должен содержать номер страницы, и 'page_size', который должен содержать количество городов на странице.

Метод вернет список городов. Формат города как в методе из задания 1.


### Задание 3:

Метод доступен по адресу 

```web-idl
127.0.0.1:8000/compare_cities?city_1=str&city_2=str
```

Данный метод принимает 2 параметра GET: 'city_1' и 'city_2', которые должны содержать названия двух городов (на русском языке).

Для поиска городу по названию используется функция `find_city_by_name`, которая ищет название города в `alternatenames` 
города, затем сортирует по населению городов и возвращает с самым большим.

Для нахождения более северного города сравниваются показатели широты, город с большей широтой располагается севернее.

Для нахождения разницы во времени используется библиотека pendulum, в которую передается название таймзоны. 
Далее сравниваются полученные значения.

Метод вернет json:

```json
{
  "city_1": {json объект города},
  "city_2": {json объект города},
  "northern": "city_name",
  "same_timezone": false,
  "time_difference": 1
}
```